DROP TABLE IF EXISTS PROMOTIONS_CARTS;
DROP TABLE IF EXISTS CART_DETAILS;
DROP TABLE IF EXISTS CARTS;
DROP TABLE IF EXISTS COUNTRY_TAXES;
DROP TABLE IF EXISTS PAYMENT_METHODS;

CREATE TABLE IF NOT EXISTS PAYMENT_METHODS (
    ID                  BINARY(16),
    NAME                VARCHAR(100)    NOT NULL,
    CHARGE              DOUBLE          NOT NULL,

    PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS COUNTRY_TAXES (
    ID                  BINARY(16),
    COUNTRY             VARCHAR(100)    NOT NULL,
    TAX                 DOUBLE          NOT NULL,

    PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS CARTS (
    ID                  BINARY(16),
    ID_USER             BINARY(16)      NOT NULL,
    TOTAL_PRICE         DECIMAL(10,3)   NOT NULL,
    TOTAL_WEIGHT        DOUBLE          NOT NULL,
    COUNTRY_TAX_ID      BINARY(16),
    PAYMENT_METHOD_ID   BINARY(16),
    CREATED_AT          TIMESTAMP,
    UPDATED_AT          TIMESTAMP,
    STATE               VARCHAR(30)     NOT NULL,

    PRIMARY KEY (ID),
    FOREIGN KEY (COUNTRY_TAX_ID) REFERENCES COUNTRY_TAXES(ID),
    FOREIGN KEY (PAYMENT_METHOD_ID) REFERENCES PAYMENT_METHODS(ID)
);

CREATE TABLE IF NOT EXISTS CART_DETAILS (
    CART_ID             BINARY(16)          NOT NULL,
    PRODUCT_ID          BINARY(16)          NOT NULL,
    QUANTITY            INTEGER             NOT NULL,
    TOTAL_WEIGHT        DOUBLE              NOT NULL,
    TOTAL_ITEM_PRICE    DECIMAL(10,3)       NOT NULL,

    FOREIGN KEY (CART_ID) REFERENCES CARTS(ID) ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS PROMOTIONS_CARTS(
    ID_PROMOTION        BINARY(16),
    CART_ID             BINARY(16)            NOT NULL,

    PRIMARY KEY (ID_PROMOTION, CART_ID),
    FOREIGN KEY (CART_ID) REFERENCES CARTS(ID) ON DELETE RESTRICT ON UPDATE CASCADE
);